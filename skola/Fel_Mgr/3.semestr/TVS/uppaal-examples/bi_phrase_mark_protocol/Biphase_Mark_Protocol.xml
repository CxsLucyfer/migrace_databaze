<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
const int CELL = 32; // delka bunky v hodinovych cyklech 
const int MARK = 16; // delka podbunky v hodinovych cyklech 
const int DELKA_VZORKU = 23; // delka jednoho samplovani v hodinovych cyklech
// const int DELKA_VZORKU = 43; // delka jednoho samplovani v hodinovych cyklech
const int MIN = 81; // min delka hodinoveho cyklu
const int MAX = 100; // max delka hodinoveho cyklu
const int DELKA_HRANY = 81; // max. delka nabehu (nestabilni) hrany 

 
int vstup, vystup;
broadcast chan tik,tak;
urgent chan posli,prijmi;
urgent chan hrana;
int napeti;
int samplovane_napeti;</declaration><template><name x="5" y="5">encoder</name><parameter>broadcast chan &amp;tik, urgent chan &amp;prijmi, urgent chan &amp;hrana</parameter><declaration>// Place local declarations here.
int n;</declaration><location id="id0" x="96" y="-96"><name x="120" y="-104">C4</name><urgent/></location><location id="id1" x="96" y="32"><name x="112" y="40">C2</name></location><location id="id2" x="96" y="-224"><name x="112" y="-256">C3</name></location><location id="id3" x="-160" y="32"><name x="-192" y="40">C1</name><urgent/></location><location id="id4" x="-160" y="-224"><name x="-192" y="-248">C0</name><urgent/></location><init ref="id4"/><transition><source ref="id1"/><target ref="id1"/><label kind="guard" x="176" y="64">n &lt; MARK - 1</label><label kind="synchronisation" x="176" y="80">tik?</label><label kind="assignment" x="176" y="95">n++</label><nail x="128" y="128"/><nail x="192" y="32"/></transition><transition><source ref="id2"/><target ref="id2"/><label kind="guard" x="176" y="-312">n &lt; CELL - 1</label><label kind="synchronisation" x="176" y="-297">tik?</label><label kind="assignment" x="176" y="-282">n++</label><nail x="128" y="-320"/><nail x="192" y="-224"/><nail x="112" y="-224"/></transition><transition><source ref="id0"/><target ref="id2"/><label kind="synchronisation" x="112" y="-160">hrana!</label></transition><transition><source ref="id1"/><target ref="id0"/><label kind="guard" x="112" y="-56">n == MARK - 1</label><label kind="synchronisation" x="112" y="-41">tik?</label><label kind="assignment" x="112" y="-26">n++</label></transition><transition><source ref="id3"/><target ref="id1"/><label kind="guard" x="-64" y="40">vstup == 1</label><label kind="synchronisation" x="-64" y="55">hrana!</label></transition><transition><source ref="id4"/><target ref="id3"/><label kind="synchronisation" x="-216" y="-112">prijmi?</label></transition><transition><source ref="id3"/><target ref="id2"/><label kind="guard" x="-92" y="-126">vstup == 0</label><label kind="synchronisation" x="-92" y="-111">hrana!</label></transition><transition><source ref="id2"/><target ref="id4"/><label kind="guard" x="-48" y="-280">n == CELL - 1</label><label kind="synchronisation" x="-48" y="-265">tik?</label><label kind="assignment" x="-48" y="-250">n=0</label></transition></template><template><name>hodiny</name><parameter>int min, int max, broadcast chan &amp;tik</parameter><declaration>clock x;</declaration><location id="id5" x="0" y="0"><label kind="invariant" x="-10" y="15">x &lt;= max</label></location><init ref="id5"/><transition><source ref="id5"/><target ref="id5"/><label kind="guard" x="200" y="0">x&gt;=min</label><label kind="synchronisation" x="200" y="15">tik!</label><label kind="assignment" x="200" y="30">x=0</label><nail x="192" y="64"/><nail x="192" y="0"/></transition></template><template><name>drat</name><parameter>urgent chan &amp;hrana, int &amp;vystupni_napeti</parameter><declaration>clock z;
int v;</declaration><location id="id6" x="192" y="0"><name x="160" y="-32">D_CHYBA_MODELU</name></location><location id="id7" x="0" y="0"><name x="24" y="8">D1</name><label kind="invariant" x="24" y="24">z &lt;= DELKA_HRANY</label></location><location id="id8" x="-192" y="0"><name x="-202" y="-30">D0</name></location><init ref="id8"/><transition><source ref="id7"/><target ref="id8"/><label kind="guard" x="-216" y="88">z == DELKA_HRANY</label><label kind="assignment" x="-216" y="120">vystupni_napeti = v</label><nail x="-128" y="80"/><nail x="-192" y="80"/></transition><transition><source ref="id7"/><target ref="id7"/><label kind="assignment" x="-56" y="144">vystupni_napeti = 1 - vystupni_napeti</label><nail x="-32" y="128"/><nail x="32" y="128"/></transition><transition><source ref="id7"/><target ref="id6"/><label kind="synchronisation" x="72" y="-24">hrana?</label></transition><transition><source ref="id8"/><target ref="id7"/><label kind="synchronisation" x="-144" y="-55">hrana?</label><label kind="assignment" x="-144" y="-40">z=0,
v=1-v</label></transition></template><template><name>sampler</name><parameter>broadcast chan &amp;tik, int &amp;napeti, int &amp;new </parameter><declaration>clock s;</declaration><location id="id9" x="64" y="0"></location><location id="id10" x="-128" y="0"><label kind="invariant" x="-184" y="16">s &lt; DELKA_VZORKU</label></location><init ref="id10"/><transition><source ref="id10"/><target ref="id9"/><label kind="assignment" x="-64" y="-128">new=napeti</label><label kind="comments">vzorkuje</label><nail x="-128" y="-128"/><nail x="64" y="-128"/></transition><transition><source ref="id9"/><target ref="id10"/><label kind="synchronisation" x="-40" y="-24">tik?</label><label kind="assignment" x="-40" y="0">s=0</label></transition></template><template><name>decoder</name><parameter>broadcast chan &amp;tik, int &amp;new, urgent chan &amp;posli, int &amp;vystup</parameter><declaration>int old,m;</declaration><location id="id11" x="128" y="288"><name x="144" y="296">D2</name><urgent/></location><location id="id12" x="124" y="-98"><name x="140" y="-82">D1</name></location><location id="id13" x="-256" y="-96"><name x="-288" y="-80">D0</name></location><init ref="id13"/><transition><source ref="id13"/><target ref="id13"/><label kind="guard" x="-360" y="-192">new == old</label><label kind="synchronisation" x="-336" y="-168">tik?</label><nail x="-256" y="-120"/><nail x="-256" y="-192"/><nail x="-352" y="-96"/></transition><transition><source ref="id12"/><target ref="id12"/><label kind="guard" x="168" y="-184">m &lt; DELKA_VZORKU - 1</label><label kind="synchronisation" x="184" y="-160">tik?</label><label kind="assignment" x="200" y="-145">m++</label><nail x="124" y="-194"/><nail x="220" y="-98"/></transition><transition><source ref="id11"/><target ref="id13"/><label kind="synchronisation" x="-124" y="81">posli!</label><label kind="assignment" x="-124" y="96">m=0</label></transition><transition><source ref="id12"/><target ref="id11"/><label kind="guard" x="144" y="16">m == DELKA_VZORKU - 1</label><label kind="synchronisation" x="144" y="31">tik?</label><label kind="assignment" x="144" y="46">vystup=(new != old),
m++,
old=new</label></transition><transition><source ref="id13"/><target ref="id12"/><label kind="guard" x="-72" y="-94">new != old</label><label kind="synchronisation" x="-72" y="-79">tik?</label><label kind="assignment" x="-72" y="-64">old=new</label></transition></template><template><name>tester</name><parameter>urgent chan &amp;prijmi, urgent chan &amp;posli, int &amp;vstup, int &amp;vystup</parameter><declaration>int buffer;</declaration><location id="id14" x="-384" y="192"><name x="-456" y="208">T_CHYBA_PROTOKOLU</name></location><location id="id15" x="-32" y="0"><name x="-48" y="24">T_CHYBA_MODELU</name></location><location id="id16" x="-192" y="0"><name x="-184" y="8">T2</name></location><location id="id17" x="-384" y="0"><name x="-376" y="8">T1</name></location><location id="id18" x="-576" y="0"><name x="-608" y="8">T0</name></location><init ref="id18"/><transition><source ref="id17"/><target ref="id18"/><label kind="guard" x="-544" y="-216">vstup == vystup</label><label kind="synchronisation" x="-544" y="-184">prijmi?</label><nail x="-416" y="-192"/><nail x="-576" y="-192"/></transition><transition><source ref="id16"/><target ref="id17"/><label kind="guard" x="-320" y="-216">vystup == buffer</label><label kind="synchronisation" x="-320" y="-184">prijmi?</label><nail x="-192" y="-192"/><nail x="-352" y="-192"/></transition><transition><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-504" y="-112">posli!</label><label kind="assignment" x="-504" y="-88">vstup=0</label><nail x="-512" y="-64"/><nail x="-448" y="-64"/></transition><transition><source ref="id17"/><target ref="id16"/><label kind="synchronisation" x="-312" y="-128">posli!</label><label kind="assignment" x="-312" y="-104">buffer=vstup,
vstup=0</label><nail x="-320" y="-64"/><nail x="-256" y="-64"/></transition><transition><source ref="id18"/><target ref="id14"/><label kind="synchronisation" x="-568" y="160">prijmi?</label><nail x="-576" y="192"/></transition><transition><source ref="id16"/><target ref="id14"/><label kind="guard" x="-184" y="128">vystup != buffer</label><label kind="synchronisation" x="-184" y="159">prijmi?</label><nail x="-192" y="192"/></transition><transition><source ref="id17"/><target ref="id14"/><label kind="guard" x="-368" y="96">vystup != vstup</label><label kind="synchronisation" x="-368" y="128">prijmi?</label></transition><transition><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-504" y="1">posli!</label><label kind="assignment" x="-504" y="24">vstup=1</label></transition><transition><source ref="id17"/><target ref="id16"/><label kind="synchronisation" x="-320" y="1">posli!</label><label kind="assignment" x="-320" y="24">buffer=vstup,
vstup=1</label></transition><transition><source ref="id16"/><target ref="id15"/><label kind="synchronisation" x="-128" y="8">posli!</label></transition></template><system>// Place template instantiations here.
Hodiny1 = hodiny(MIN,MAX,tik);
Hodiny2 = hodiny(MIN,MAX,tak);
Encoder = encoder(tik,posli,hrana);
Drat = drat(hrana, napeti);
Sampler = sampler(tak,napeti,samplovane_napeti);
Decoder = decoder(tak,samplovane_napeti,prijmi,vystup);
Tester = tester(prijmi,posli,vstup,vystup);

// List one or more processes to be composed into a system.
system Hodiny1, Hodiny2, Encoder, Drat, Sampler, Decoder, Tester;</system></nta>
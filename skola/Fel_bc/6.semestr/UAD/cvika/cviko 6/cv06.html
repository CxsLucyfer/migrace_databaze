<?xml version="1.0" encoding="iso-8859-2" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="cz" dir="ltr">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2" />
<meta name="generator" content="Myself" />
<meta name="keywords" content="UNIX administration" />
<meta name="author" content="Jan ®ïárek &lt;cz.cvut.fel_._zdarekj&gt;" />

<title>Y36UAD -- Konfigurace a pøeklad jádra, konfigurace bootování</title>
<link rel="stylesheet" type="text/css" href="./uad.css" />
</head>
<!-- Last 9.4.2008, 100, valid X -->

<body> 
<h1>Konfigurace a pøeklad jádra Linux</h1>
<hr />
<h2>Jádro Linux</h2>
<p>
Na pøedná¹ce jste se seznámili se základními rysy jader OS a se specifickými
vlastnostmi jádra Linux.
Cílem cvièení bude vyzkou¹et si konfiguraci, pøeklad a instalaci pøelo¾eného 
jádra a jeho souèástí do systému.
</p>
<h2>Konfigurace jádra</h2>
<p>
Jádro Linux volnì dostupné pøes ftp na adrese <tt>ftp.eu.kernel.org/pub</tt>.
Pro úèely dne¹ního cvièení ale není nutné ztrácet èas s jeho stahováním, 
archiv <tt>linux-2.6.24.4.tar.bz2</tt> s aktuální stabilní verzí kompletního
zdrojového kódu jádra je ji¾ pøipraven na standardním místì 
pro nìj vyhrazeném, tj. v adresáøi <tt>/usr/src/</tt>.
</p>
<p>Zdrojový kód jádra je sám o sobì rozsáhlý a velikost první partition na 
disku je omezená, bude nutné si nejprve pøipravit volnou partition o velikosti 
alespoò 3 GB. (Rozbalit zdrojové kódy by se nám mìlo povést i do <tt>/usr/src</tt>,
ale pøelo¾ený kód se ji¾ nevejde.)
</p>
<h3>Úkol 1</h3>
<p>
Pøidejte novou partition, zformátujte ji, pøipojte a rozbalte na ni archiv
<tt>linux-2.6.24.4.tar.bz2</tt>.<br />
Pøesuòte se do hlavního adresáøe novì rozbalené adresáøové struktury.
</p>
<h3>Úkol 2</h3>
<p>
Seznamte se se strukturou a obsahem rozbaleného archivu.<br />
Vyzkou¹ejte pøíkaz <tt>make help</tt>.
</p>
<p>
Konfigurace jádra je vlastnì velmi jednoduchá, existují na to pomùcky 
(<tt>make menuconfig</tt>, <tt>make xconfig</tt>). Slo¾ité je správnì 
porozumìt struktuøe a závislostem mezi komponentami, z nich¾ se skládá 
tak komplexní jádro jako je Linux. <!-- Konfiguraèní nástroje ale <i>nìkteré</i>
volby hlídají a nedovolí navolit apriori nesmyslnou kombinaci, u jiných ale 
nechávají administrátorovi plnou volnost. -->
Dal¹í komplikací je správná identifikace komponent systému a nalezení 
odpovídajících ovladaèù v jádøe.
</p>
<p>
S výhodou vyu¾ijeme faktu, ¾e máme k dispozici bì¾ící systém s jádrem 
stejné øady, jako chceme nakonfigurovat. Vyu¾ijeme-li standardní nástroje 
pro prozkoumání systému, tj. adresáø <tt>/proc</tt>; <tt>/sbin/lspci</tt>, 
<tt>/sbin/lsmod</tt>, budeme schopni velmi rozumnì odhadnout øadu potøebných 
ovladaèù.
</p>
<h3>Úkol 3</h3>
<p>
Nakonfigurujte jádro. Pro konfiguraci vyu¾ijte standardní nástroje pro 
prozkoumání systému.<br />
Doporuèení:
</p>
<ol>
  <li>Pokuste se pokud mo¾no dekonfigurovat (odnastavit) co mo¾ná nejvìt¹í 
  poèet nepotøebných konfiguraèních voleb (ovladaèù). Pøeklad podle 
  standardního nenakonfigurovaného <tt>.config</tt> trvá více ne¾ 30 minut!
  </li>
  <li>Naleznìte a nakonfigurujte klíèové komponenty pro boot jádra: øadiè 
  disku (SATA Driver, <tt>libata</tt>, Marvell PATA <tt></tt>, 
  èipset (Intel ESB/PIIX3/4), souborové systémy, pøípadnì podporu initrd 
  (startovací RAM disk)).
  </li>
</ol>
<p>
Máme-li jádro nakonfigurované, musíme jej pøelo¾it, pøipravit pøípadné moduly 
k pou¾ití a upravit konfiguraci boot-manageru.
</p>
<p>
Pøeklad se pro øadu jader 2.6 provede velmi jednodu¹e spu¹tìní pøíkazu <tt>make</tt>.
</p>
<p>
Instalace modulù do <tt>/lib/modules</tt> a spoèítání závislostí je takté¾ 
automatizovaná. Máme-li pøedchozím krokem v¹e øádnì pøelo¾eno, staèí zavolat 
<tt>make modules_install</tt>.<br />
(Pozn.: Moduly se v øadì jader 2.6 automaticky pøekládají spolu se staticky 
linkovanými èástmi jádra a není nutné je pøekládat zvlá¹».)
</p>
<h3>Initial RAMdisk</h3>
<p>
Obsah startovacího RAM disku mù¾eme vytvoøit ruènì, na nìkterých distribucích, 
které se velmi spoléhají na modulární jádra, existuje nástroj pomáhající 
s jeho vytvoøením (<tt>/sbin/mkinitrd</tt>). Tento program 
se pokusí detekovat dostupný HW, najde pro nìj moduly (musí být zkompilované 
a nainstalované v <tt>/lib/modules</tt>), a nakonec vytvoøí obsah pøizpùsobený 
danému stroji.<br />
Máme-li nìkteré moduly po¾adované autodetekovaným HW zakompilované 
staticky do jádra, vyjmenujeme je na pøíkazové øádce volbou 
<tt>mkinitrd --builtin=<i>jméno_modulu</i></tt>&nbsp;.
</p>
<p>
Máme-li jádro, moduly a pøípadnì initialRAMdisk pøipravený, nakopírujeme 
soubory <tt>.config</tt>, <tt>System.map</tt>, <tt>arch/x86/boot/bzImage</tt>, 
pøípadnì <tt>initrd-2.6.24.4.img</tt> pod vhodnými názvy do adresáøe 
<tt>/boot</tt>. Inspirujte se ji¾ existujícími soubory v nìm.
</p>
<p>
Úprava boot-konfigurace zále¾í na pou¾ívaném boot-manageru, je-li to GRUB jako
v na¹em pøípadì, vyu¾ijeme znalostí z pøedná¹ky a pøidáme dal¹í polo¾ku 
do <tt>/boot/grub/grub.conf</tt>.<br />
Doporuèení:
Pøi ladìní nového jádra si ponechejte mo¾nost nabootovat alespoò jedno funkèní 
jádro, abyste v pøípadì nefukènosti mìli mo¾nost snadno pøebootovat do funkèní
konfigurace.
</p>
<p>
Alternativou k ruèní konfiguraci je pou¾ití <tt>make install</tt>, který se 
pokusí jádro nainstalovat a doplnit do boot-konfigurace. Pøi tomto postupu 
ale nemù¾eme pøímo ovlivnit, co/jak/kam a kde se stane.
</p>
<h3>Úkol 4</h3>
<p>
Ovìøte funkènost své konfigurace rebootováním stroje a pou¾itím nové 
konfiguraèní volby.
</p>
<hr />
<p><img src="../obr/ESFgrant.png" width="161" height="22" alt="Partially supported by ESF and City of Prague." /></p>
</body>
</html>
